<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Brick Breaker Upgrade</title>

<style>
    body {
        margin: 0;
        background: #0b0f19;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-family: Arial;
        overflow: hidden;
    }

    canvas {
        background: #0f1526;
        border: 2px solid #00eaff;
        border-radius: 12px;
        box-shadow: 0 0 20px #00eaff55;
    }

    #msg {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        color: white;
        text-align: center;
        font-size: 26px;
        display: none;
    }

    #msg button {
        margin-top: 15px;
        padding: 10px 25px;
        font-size: 18px;
        border: none;
        border-radius: 10px;
        background: #00eaff;
        color: #000;
        cursor: pointer;
        font-weight: bold;
    }
    
    #backBtn {
        position: absolute;
        top: 15px;
        left: 15px;
        background: #00eaff;
        padding: 10px 18px;
        color: #000;
        text-decoration: none;
        font-weight: bold;
        border-radius: 10px;
        font-size: 16px;
        box-shadow: 0 0 10px #00eaff66;
        transition: 0.2s;
        z-index: 10;
    }
    
    #backBtn:hover {
        transform: scale(1.07);
        background: #00f5ff;
    }

</style>
</head>

<body>
<a href="index.html" id="backBtn">‚üµ Kembali</a>

<canvas id="game"></canvas>

<div id="msg">
    <h2 id="msgText"></h2>
    <button onclick="restart()">Main Lagi</button>
</div>

<script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    // Auto-resize canvas mengikuti ukuran layar
    function resize() {
        let size = Math.min(window.innerWidth * 0.9, 420);
        canvas.width = size;
        canvas.height = size * 1.3;
    }
    resize();
    window.addEventListener("resize", resize);

    // GAME VARIABLES
    let paddle = {
        w: canvas.width * 0.35,
        h: 14,
        x: canvas.width / 2 - (canvas.width * 0.35) / 2,
        y: canvas.height - 40
    };

    let ball = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        r: 9,
        dx: 4,
        dy: -4
    };

    const brick = {
        rows: 5,
        cols: 6,
        w: canvas.width / 6 - 10,
        h: 18,
        padding: 8,
        offsetTop: 40,
        offsetLeft: 5
    };

    let bricks = [];
    let gameOver = false;

    function initBricks() {
        bricks = [];
        for (let r = 0; r < brick.rows; r++) {
            bricks[r] = [];
            for (let c = 0; c < brick.cols; c++) {
                bricks[r][c] = { x: 0, y: 0, destroyed: false };
            }
        }
    }

    initBricks();

    // DRAW FUNCTIONS
    function drawPaddle() {
        ctx.fillStyle = "#00eaff";
        ctx.fillRect(paddle.x, paddle.y, paddle.w, paddle.h);
    }

    function drawBall() {
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
        ctx.fillStyle = "#00eaff";
        ctx.fill();
        ctx.closePath();
    }

    function drawBricks() {
        for (let r = 0; r < brick.rows; r++) {
            for (let c = 0; c < brick.cols; c++) {
                if (!bricks[r][c].destroyed) {
                    let bx = c * (brick.w + brick.padding) + brick.offsetLeft;
                    let by = r * (brick.h + brick.padding) + brick.offsetTop;

                    bricks[r][c].x = bx;
                    bricks[r][c].y = by;

                    ctx.fillStyle = "#00eaff";
                    ctx.fillRect(bx, by, brick.w, brick.h);
                }
            }
        }
    }

    // GAME LOOP
    function update() {
        if (gameOver) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        drawPaddle();
        drawBall();
        drawBricks();

        // Ball movement
        ball.x += ball.dx;
        ball.y += ball.dy;

        // Wall collision
        if (ball.x + ball.r > canvas.width || ball.x - ball.r < 0) ball.dx *= -1;
        if (ball.y - ball.r < 0) ball.dy *= -1;

        // Paddle collision
        if (
            ball.y + ball.r >= paddle.y &&
            ball.x >= paddle.x &&
            ball.x <= paddle.x + paddle.w
        ) {
            ball.dy *= -1;

            // Tambah kecepatan sedikit tiap kena paddle
            ball.dx *= 1.05;
            ball.dy *= 1.05;
        }

        // Game Over
        if (ball.y - ball.r > canvas.height) {
            showMsg("Game Over");
            return;
        }

        // Brick collision
        let win = true;
        for (let r = 0; r < brick.rows; r++) {
            for (let c = 0; c < brick.cols; c++) {
                let b = bricks[r][c];
                if (!b.destroyed) {
                    win = false;

                    if (
                        ball.x > b.x &&
                        ball.x < b.x + brick.w &&
                        ball.y > b.y &&
                        ball.y < b.y + brick.h
                    ) {
                        ball.dy *= -1;
                        b.destroyed = true;

                        // speed up
                        ball.dy *= 1.08;
                        ball.dx *= 1.08;
                    }
                }
            }
        }

        if (win) {
            showMsg("Kamu Menang! üî•");
            return;
        }

        requestAnimationFrame(update);
    }

    update();

    // MOBILE + DESKTOP CONTROL
    function movePaddle(x) {
        paddle.x = x - paddle.w / 2;

        if (paddle.x < 0) paddle.x = 0;
        if (paddle.x + paddle.w > canvas.width) paddle.x = canvas.width - paddle.w;
    }

    canvas.addEventListener("mousemove", e => {
        movePaddle(e.offsetX);
    });

    canvas.addEventListener("touchmove", e => {
        let rect = canvas.getBoundingClientRect();
        let x = e.touches[0].clientX - rect.left;
        movePaddle(x);
    });

    // GAME OVER / WIN SCREEN
    function showMsg(text) {
        const msg = document.getElementById("msg");
        const txt = document.getElementById("msgText");
        txt.innerHTML = text;
        msg.style.display = "block";
        gameOver = true;
    }

    function restart() {
        ball.x = canvas.width / 2;
        ball.y = canvas.height / 2;
        ball.dx = 4;
        ball.dy = -4;

        gameOver = false;
        document.getElementById("msg").style.display = "none";

        initBricks();
        update();
    }
</script>

</body>
</html>
